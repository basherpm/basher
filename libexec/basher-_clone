#!/usr/bin/env bash
#
# Summary: Clones a package from github, but doesn't install it
# Usage: basher _clone <package>

set -e

if [ "$#" -lt 1 ]; then
  basher-help _clone
  exit 1
fi

package=$1

if [ -z "$package" ]; then
  basher-help _clone
  exit 1
fi

site=${2:-github.com}
proto=https

[[ $site == *@* ]] && {
  IFS=@ read -r login site <<< "$site"
  proto=ssh
}

IFS=/ read -r user name <<< "$package"

if [ -z "$user" ]; then
  basher-help _clone
  exit 1
fi

if [ -z "$name" ]; then
  basher-help _clone
  exit 1
fi

if [ -e "$BASHER_PACKAGES_PATH/$package" ]; then
  echo "Package '$package' is already present"
  exit 0
fi

[[ $proto == "ssh" ]] && repo=$login${login:+@}$site: || repo=$proto://$site/

git clone --depth=1 --recursive "$repo$package".git "${BASHER_PACKAGES_PATH}/$package"
