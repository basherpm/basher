#!/usr/bin/env bash
#
# Summary: List installed packages
# Usage: basher list

set -e

if [ "$#" -gt 0 ]; then
  basher-help list
  exit 1
fi
which wget &>/dev/null && {
  dl() {
    wget "$1" -O $2 $3
  }
  Q="-q"
} || {
  dl() {
    curl -L "$1" -o $2 $3
  }
  Q="-s"
}

shopt -s nullglob

for package_path in ${BASHER_PACKAGES_PATH}/*/*
do
  username="$(dirname "$package_path")"
  username="${username##*/}"
  package="${package_path##*/}"
  description="$(dl "https://api.github.com/repos/$username/$package" - $Q | sed '/  "description": "/!d;s/  "description": "//g;s/",//g')"
  [ "$description" = "" ] && echo "$username/$package" || echo "$username/$package	$description"
done
